(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&c(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function c(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const i=(e,t)=>{e=Math.abs(e),t=Math.abs(t);const n=Math.ceil(Math.min(e,t)),c=Math.floor(Math.max(e,t)),o=Math.random()*(c-n+1)+n;return Math.floor(o)},p=e=>e[i(0,e.length-1)],M=()=>{let e=0;return()=>(e+=1,e)},y=(e,t,n)=>{const c=document.createDocumentFragment();for(const o of t)c.append(n(o));e.append(c)},q=({key:e})=>e==="Escape",f=e=>document.getElementById(e).content.firstElementChild,N=5,b=f("comment"),m=document.querySelector(".social__comments"),P=document.querySelector(".social__comment-count"),g=document.querySelector(".social__comments-loader");let d=[];const A=e=>{const t=b.cloneNode(!0);return t.querySelector(".social__picture").src=e.avatar,t.querySelector(".social__text").textContent=e.message,t},I=()=>{const e=d.length,t=m.children.length;let n=t+N;const c=n>=e;n=c?e:n;const o=d.slice(t,n);y(m,o,A),P.textContent=`${n} из ${e} комментариев`,g.hidden=c};g.addEventListener("click",I);const w=e=>{d=e,g.click()},O=()=>{m.innerHTML="",d=[]},U=document.body,l=document.querySelector(".big-picture"),k=l.querySelector(".cancel"),R=({url:e,description:t,likes:n})=>{l.querySelector(".big-picture__img").querySelector("img").src=e,l.querySelector(".social__caption").textContent=t,l.querySelector(".likes-count").textContent=n},x=e=>{q(e)&&(e.preventDefault(),E())},_=(e=!0)=>{l.classList.toggle("hidden",!e),U.classList.toggle("modal-open",e)};function E(){_(!1),O()}k.addEventListener("click",()=>E());const D=e=>{_(!0),document.addEventListener("keydown",x),R(e),w(e.comments)},F=25,H=6,K=15,$=200,B=20,G=["Всё отлично!","В целом всё неплохо. Но не всё.","Когда вы делаете фотографию, хорошо бы убирать палец из кадра. В конце концов это просто непрофессионально.","Моя бабушка случайно чихнула с фотоаппаратом в руках и у неё получилась фотография лучше.","Я поскользнулся на банановой кожуре и уронил фотоаппарат на кота и у меня получилась фотография лучше.","Лица у людей на фотке перекошены, как будто их избивают. Как можно было поймать такой неудачный момент?!"],V=["Пляж","Указатель показывает, направление до пляжа","Скалистый берег","Девушка на пляже с фотоаппаратом","Забавный мисо суп с человечками из риса","Японский автомобиль с открытой ламба дверью","На деревянной тарелке клубника разрезанная на две половики","Две прозрачные чашки с горячим напитком из красной смородины"],z=["Мария","Алексей","Артур","Виктор","Александр","Мариса","Мирон","Анна"],j=M(),X=()=>Array.from({length:i(1,2)},()=>p(G)).join(" "),Z=()=>({id:j(),avatar:`img/avatar-${i(1,H)}.svg`,message:X(),name:p(z)}),J=e=>({id:e,url:`photos/${e}.jpg`,description:p(V),likes:i(K,$),comments:Array.from({length:i(4,B)},Z)}),C=()=>Array.from({length:F},(e,t)=>J(t+1));C();const S=C(),Q=e=>S.find(t=>t.id===e),W=f("picture"),Y=document.querySelector(".pictures"),ee=e=>{e.preventDefault();const n=+e.currentTarget.dataset.thumbnailId,c=Q(n);D(c)},te=({comments:e,description:t,likes:n,url:c,id:o})=>{const s=W.cloneNode(!0),a=s.querySelector(".picture__img");return a.src=c,a.alt=t,s.querySelector(".picture__comments").textContent=e.length,s.querySelector(".picture__likes").textContent=n,s.dataset.thumbnailId=o,s},oe=e=>{const t=te(e);return t.addEventListener("click",ee),t},ne=e=>y(Y,e,oe);ne(S);const r=document.querySelector(".img-upload__form"),se=r.querySelector("#upload-file"),u=r.querySelector(".img-upload__overlay"),ce=u.querySelector("#upload-cancel"),T=r.querySelector(".text__hashtags"),L=r.querySelector(".text__description"),re=/^#[a-zа-яё0-9]{1,19}$/i,ae=5,le="Неправильный формат хэштэга, должен начинаться с #",ie="Допустимое количество знаков не больше 140!",h=new Pristine(r,{classTo:"img-upload__field-wrapper",errorTextParent:"img-upload__field-wrapper",errorTextClass:"img-upload__field-wrapper--error"}),de=()=>{document.removeEventListener("keydown",v)},ue=()=>{ce.addEventListener("click",()=>{u.classList.add("hidden"),document.body.classList.remove("modal-open")}),document.addEventListener("keydown",v),r.reset()};se.addEventListener("change",e=>{e.preventDefault(),document.body.classList.add("modal-open"),u.classList.remove("hidden"),ue()});function v(e){e.key==="Escape"&&(document.body.classList.remove("modal-open"),u.classList.add("hidden"),de())}T.addEventListener("keydown",e=>{e.key==="Escape"&&e.stopPropagation()});L.addEventListener("keydown",e=>{e.key==="Escape"&&e.stopPropagation()});const me=e=>e.length<=140,pe=e=>re.test(e),ge=e=>e.length<=ae,he=e=>{const t=e.map(n=>n.toLowerCase());return t.length===new Set(t).size},ye=e=>{const t=e.trim().split(" ").filter(n=>n.trim().length);return t.every(pe)&&ge(t)&&he(t)};h.addValidator(L,me,ie);h.addValidator(T,ye,le);r.addEventListener("submit",e=>{e.preventDefault(),h.validate()});
